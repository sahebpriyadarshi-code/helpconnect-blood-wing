# HelpConnect – Blood Wing (V1.5)

## Overview
HelpConnect – Blood Wing is a blood donation matching platform that connects blood donors with people in need of blood donations. The application facilitates blood requests, donor registration, and matching between donors and recipients using Airtable as the data storage backend and Express.js as the API server.

## Core Features

### User Roles & Profiles
- Users can have roles: requester, donor, or both
- User profile model includes role information
- Profile modal displays user roles and allows role management
- Donor dashboard reflects user roles and profile status

### Blood Request System
- Users can submit blood requests specifying blood type, urgency level, location, and contact information
- Requests include patient details, hospital information, and required blood units
- Each request has an enhanced status lifecycle: pending → searching → donor_contacted → matched → fulfilled
- Request status updates require explicit manual confirmation

### Enhanced Matching Visibility
- After blood request creation, display "Searching for compatible donors nearby" message
- Query compatible donors by blood type and city to show "Potential donors found" indicator when matches exist
- Status indicators are informational only with no automatic contact or matching
- Current status text is clearly highlighted within the status timeline

### Donor Interest System
- Donors can express interest in specific blood requests by clicking "I am available to donate"
- Interest recording is idempotent (prevents duplicate interests from same donor)
- When a donor expresses interest and the request status is "searching", the status automatically updates to "donor_contacted"
- Requesters can see the count of interested donors without revealing donor contact information
- Interest tracking includes timestamp for each donor response

### Requester-Controlled Donor Selection
- Requesters can view a list of donors who have expressed interest in their blood requests
- Donor list displays first name, blood type, and city/location only (no contact details initially)
- Each donor entry includes a "Contact this donor" button, active only for the requester who created the blood request
- When requester clicks "Contact this donor", the request status updates from "donor_contacted" to "matched"
- Selected donor's contact information is revealed only to the requester after selection
- Safety messaging displays: "Contact does not guarantee successful donation. Please confirm availability directly."
- Donor contact details are not exposed to other donors or public views

### Donor Registration and Response System
- Donors can view available blood requests filtered by both blood type compatibility and city match
- When no donor profile exists, display neutral informational message with "Register as Donor" button
- When donor profile exists, show filtered blood requests matching both blood type and city location
- If no compatible requests available, display "No compatible requests nearby at the moment"
- Each blood request displays an "I am available to donate" button for expressing interest
- After expressing interest, button is disabled and shows "Interest recorded" confirmation
- Donors can accept or reject specific blood requests
- Acceptance creates a match record and updates the request status to "matched"
- Rejection updates the request status appropriately

### Donor Health Information
- Health status collection uses structured checklist format
- Checklist options: "No chronic illness", "No recent surgery", "Eligible to donate"
- Optional notes field for additional health information
- Backend stores checklist response structure instead of plain text

### Enhanced Status Tracking
- Extended request status lifecycle: pending → searching → donor_contacted → matched → fulfilled
- "My Blood Requests" page displays timeline steps clearly with highlighted current status
- Status tracking pages show enhanced lifecycle states with visibility indicators
- Display count of donors who have expressed interest for each request
- Show "Donors have responded" label when at least one donor has expressed interest
- Include informational note: "A donor response does not guarantee availability until you confirm directly"
- Manual refresh capability maintained
- Requester confirmation dialog before marking requests as "fulfilled"
- Manual matching is reflected in the status timeline progression

### Soft Abuse-Resistance and Anti-Spam Safeguards
- **Duplicate Request Awareness**: When a requester creates multiple blood requests within the past hour, display informational message: "You have recently created a blood request. Please check existing requests before creating a new one." Message is dismissible and does not prevent submission
- **Donor Response Cooldown (Soft)**: When a donor expresses interest in many requests within a short time window, display neutral prompt: "Please respond only to requests you can realistically support." Message appears briefly without restricting actions
- **Matched but Inactive Warning**: On "My Blood Requests" page, if a request is marked "matched" but no fulfillment confirmation has occurred within 12-24 hours, show passive status note: "This request may still require follow-up."
- **UI-Level Rate Awareness**: Lightweight internal counters track frequent actions (request creation, donor responses) for analytics without affecting functionality
- All safeguard messages use calm, medical-neutral tone with subtle, friendly text styling
- No blocking, restriction, or interference with emergency workflows

### Matching System
- Blood type compatibility matching between requests and donors
- City-level location filtering in addition to blood type matching
- Match records track donor responses and timestamps
- Requester-controlled donor selection with secure contact information revelation

## User Flow

### For Blood Requesters
1. Landing page with option to request blood
2. Blood request form with patient and hospital details, including duplicate request awareness messaging when applicable
3. Enhanced status page showing "Searching for compatible donors nearby" message and potential donor indicators
4. Status timeline with clearly highlighted current status and donor interest count
5. View list of interested donors with first name, blood type, and city only
6. Select specific donor using "Contact this donor" button to reveal contact information
7. Safety messaging after donor selection about confirming availability directly
8. Confirmation dialog before marking request as fulfilled
9. Final outcome page when donation process is completed
10. "My Blood Requests" page with matched but inactive warnings for requests requiring follow-up

### For Blood Donors
1. Landing page with option to donate blood
2. Profile management with role selection
3. Donor dashboard behavior:
   - If donor profile exists: filtered blood requests by both city and blood group
   - Each request shows "I am available to donate" button with soft response cooldown messaging when applicable
   - After expressing interest, button shows "Interest recorded" and is disabled
   - If no compatible requests: "No compatible requests nearby at the moment" message
   - If no donor profile: neutral message with "Register as Donor" button
4. Donor registration with health checklist
5. Express interest, accept or reject actions for specific requests
6. Final outcome page confirming their response

## Backend Architecture

### Airtable Schema
Enhanced tables with updated field structures:
- **BloodRequest**: id, blood_group, units_required, urgency, hospital_name, city, phone, status (pending/searching/donor_contacted/matched/fulfilled), created_at (auto-timestamp), requester_id, matched_at (timestamp for matched status tracking)
- **Donor**: id, name, blood_group, city, phone, health_checklist (structured data), health_notes, roles
- **Match**: id, request_id, donor_id, status (defaults to "pending"), timestamp (auto-timestamp)
- **User**: id, name, email, roles (requester/donor/both)
- **DonorInterest**: id, request_id, donor_id, timestamp (auto-timestamp)

### Express API Endpoints
- `GET /health`: Health check returning status OK
- `POST /api/request`: Creates new blood request with validation, initial status set to "pending"
- `GET /api/requests`: Lists all current requests ordered by creation time
- `GET /api/user/profile`: Gets user profile with roles
- `PUT /api/user/profile`: Updates user profile and roles
- `POST /api/donor/register`: Creates donor profile with health checklist
- `POST /api/donor/interest`: Records donor interest in specific request, updates request status to "donor_contacted" if currently "searching"
- `GET /api/donor/interests/:requestId`: Gets list of interested donors for a request with first name, blood type, and city only
- `GET /api/donor/interests/count/:requestId`: Gets count of interested donors for a request
- `POST /api/donor/accept`: Creates match record and updates request status to "matched", records matched_at timestamp
- `POST /api/donor/reject`: Updates request status appropriately
- `PUT /api/request/fulfill`: Updates request status to "fulfilled" with confirmation
- `GET /api/donors/nearby`: Finds donors by blood type and city for visibility checks
- `POST /api/request/confirmDonorMatch`: Confirms donor selection by requester, updates request status to "matched", records matched_at timestamp, returns donor contact information securely with requester ownership verification
- `GET /api/user/requests/recent`: Gets recent blood requests by user for duplicate request awareness checking

### Backend Operations
- Airtable integration via REST API using environment variables for API key and base ID
- Comprehensive error handling with explicit JSON error responses
- Blood type compatibility validation
- Enhanced request status lifecycle management including donor_contacted status
- User role management
- Structured health checklist data storage
- Donor interest tracking with duplicate prevention
- Match record creation and updates with timestamp tracking
- City-level donor filtering by blood type and location
- Donor visibility queries for matching indicators
- Requester ownership verification for donor selection
- Secure donor contact information revelation only to authorized requesters
- Recent request tracking for duplicate awareness
- Matched timestamp recording for inactive warning calculations
- Axios for Airtable requests with proper async/await

## Frontend Pages
- **LandingPage**: "Request Blood" and "I Can Donate" buttons with footer note
- **RequestBloodPage**: Blood request form with "Searching for compatible donors nearby" message after submission, duplicate request awareness messaging
- **RequestStatusPage**: Enhanced status timeline with highlighted current status, potential donor indicators, and donor interest count
- **DonorPage**: Role-aware donor dashboard with city and blood type filtering, "I am available to donate" buttons with soft response cooldown messaging, "No compatible requests nearby" message when applicable
- **ProfileModal**: User profile management with role selection
- **DonorRegistrationPage**: Health checklist form instead of free-text health status
- **MyBloodRequestsPage**: Enhanced timeline display with highlighted status, visibility indicators, donor interest counts, interested donor list with "Contact this donor" buttons, safety messaging after donor selection, and matched but inactive warnings
- **FinalOutcomePage**: Success/failure confirmation messages

## Technical Implementation

### Deployment Configuration
- Express server serves React static files from client/build directory
- Non-API routes redirect to React index.html for single service operation
- Railway deployment with environment variables for Airtable API key, base ID, and port (PORT=8080)
- Production-ready with inline code comments for data flow and safety checks
- Single command `npm run start` runs the full stack

### Data Flow and Safety
- Enhanced medical urgency handling with appropriate fallback rules
- Request validation and comprehensive error handling
- Enhanced status update consistency across match creation and donor interest
- Manual confirmation requirements for critical status changes
- Idempotent donor interest recording to prevent duplicates
- Requester-controlled donor selection with secure contact information handling
- Authorization checks for donor contact information access
- Life-critical constraints noted in comments (no promises or automation)
- All UX and error texts guide users to contact hospitals when necessary
- Calm, factual messaging for matching visibility and donor interest features
- Safety messaging for donor selection: "Contact does not guarantee successful donation. Please confirm availability directly."
- Soft abuse-resistance safeguards with non-blocking, user-guidance approach
- Frontend-based tracking for duplicate requests and donor response patterns using local storage
- Timestamp-based calculations for matched but inactive warnings
- Medical-neutral tone for all safeguard messaging

### Development and Testing
- Seed data scripts for testing with enhanced data structures
- Developer instructions for testing endpoints locally
- Documentation in README.md for deployment steps

## Pages Structure
- Landing page with dual options (request blood / donate blood)
- Blood request form page with donor search messaging and duplicate request awareness
- Enhanced request status tracking page with visibility indicators, highlighted status, and donor interest counts
- Role-aware donor view page with city and blood type filtering, interest buttons, and soft response cooldown messaging
- User profile management modal
- Donor registration page with health checklist
- My blood requests page with enhanced timeline, status highlighting, donor interest visibility, interested donor list, donor selection functionality, and matched but inactive warnings
- Final outcome confirmation page

## Technical Notes
- Blood group compatibility logic for donor-request matching
- City-level location filtering in addition to blood type matching
- Enhanced status management system (pending → searching → donor_contacted → matched → fulfilled)
- User role management (requester/donor/both)
- Structured health checklist data handling
- Donor interest tracking with idempotent recording
- Match status tracking (pending, accepted, rejected) with timestamp recording
- Donor visibility queries for informational matching indicators
- Requester-controlled donor selection with secure contact revelation
- Authorization and access control for donor contact information
- Soft abuse-resistance implementation using frontend state management and local storage
- Non-blocking safeguard messaging with medical-neutral tone
- Timestamp-based tracking for duplicate requests and inactive matches
- Rate awareness counters for analytics without functionality impact
- Mobile-first responsive design with minimalist CSS
- Single-file Express server architecture
- React Router for client-side navigation
- No animations or additional libraries beyond axios and React Router
- App content language: English
